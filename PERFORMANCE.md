# ServiceWatcher - Performance Testing Guide

このドキュメントでは、ServiceWatcherのパフォーマンステスト手順と結果を記録します。

## 成功基準 (Success Criteria)

- **SC-002**: サービス停止検知から通知表示まで1秒以内
- **SC-003**: リソース使用量
  - メモリ: 50サービス監視時に50MB未満
  - CPU: 20サービス監視時に1%未満（定常状態）
- **SC-007**: 24時間連続稼働の安定性

## テスト環境

- OS: Windows 10/11
- .NET Runtime: .NET 8.0
- 測定ツール: タスクマネージャー、パフォーマンスモニター

## テスト手順

### T129: メモリ使用量テスト（50サービス）

1. ServiceWatcherを起動
2. config.jsonに50個のサービスを登録
3. 監視を開始し、10分間安定稼働
4. タスクマネージャーでプライベートワーキングセット（メモリ）を測定

**期待値**: <50MB

**実測値**: (測定後記入)

### T130: CPU使用量テスト（20サービス）

1. ServiceWatcherを起動
2. config.jsonに20個のサービスを登録（実在する安定したサービス）
3. 監視を開始し、5分間定常状態を維持
4. タスクマネージャーでCPU使用率を測定（平均値）

**期待値**: <1%

**実測値**: (測定後記入)

### T131: 通知表示時間テスト

1. ServiceWatcherを起動し、テストサービス1つを監視
2. 手動でサービスを停止（services.mscまたはnet stop コマンド）
3. サービス停止からポップアップ表示までの時間を測定

**測定方法**:
- ストップウォッチで計測
- または、ログファイルのタイムスタンプから算出

**期待値**: <1秒

**実測値**: (測定後記入)

### T132: 24時間連続稼働テスト

1. ServiceWatcherを起動し、10-20個のサービスを監視
2. 24時間連続稼働
3. 以下を確認:
   - メモリリークがないこと（メモリ使用量が増大しないこと）
   - CPU使用率が安定していること
   - 通知が正常に表示され続けること
   - ログファイルに異常なエラーが記録されていないこと

**期待値**: クラッシュやハング無し、リソース使用量が安定

**実測値**: (測定後記入)

## 最適化のヒント

### メモリ最適化
- 通知フォームを閉じた後は確実にDisposeされることを確認
- 不要なイベントハンドラをデタッチ
- 大きなオブジェクトをキャッシュしない

### CPU最適化
- 監視間隔を適切に設定（デフォルト5秒）
- ServiceControllerのRefresh()を最小限に
- 非同期処理で UIスレッドをブロックしない

### 安定性向上
- すべての例外を適切にキャッチしてログに記録
- リソースリークを防ぐためにusing文やDisposeパターンを使用
- タイマーの適切な停止とリソース解放

## 測定結果サマリー

| テスト項目 | 期待値 | 実測値 | 合否 | メモ |
|-----------|--------|--------|------|------|
| T129: メモリ使用量（50サービス） | <50MB | - | - | - |
| T130: CPU使用率（20サービス） | <1% | - | - | - |
| T131: 通知表示時間 | <1秒 | - | - | - |
| T132: 24時間連続稼働 | 安定稼働 | - | - | - |

## 既知の制限事項

- ポーリングベースのため、監視間隔秒数分の検知遅延が発生する可能性があります
- Windows APIの制限により、一部のシステムサービスへのアクセスには管理者権限が必要です

## パフォーマンス改善履歴

### v1.0.0
- 初回リリース
- 基本的なパフォーマンス要件を満たす実装


# 機能仕様書: Windowsサービス監視システム

**機能ブランチ**: `001-service-monitor`  
**作成日**: 2025-10-30  
**ステータス**: ドラフト  
**入力**: ユーザー説明: "監視するサービスは一覧を表示して登録する。登録されたサービスを監視して、サービスが停止したらポップアップで知らせる。設定は、ファイル管理とする。"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - サービス監視と通知 (優先度: P1)

システム管理者として、登録されたWindowsサービスが停止した際に即座にポップアップ通知を受け取り、サービス停止を迅速に認識できるようにしたい。

**この優先度の理由**: サービス停止の即時検知と通知は、本システムの中核機能であり、システム障害の早期発見に直結する最も重要な機能です。

**独立テスト**: 監視対象サービスを手動で停止することで、1秒以内にポップアップ通知が表示されることを確認でき、独立した価値を提供します。

**受け入れシナリオ**:

1. **前提** アプリケーションが起動し、監視対象サービスが実行中、**操作** 監視対象のWindowsサービスを手動で停止、**結果** 1秒以内にサービス名と停止時刻を含むポップアップ通知が表示される
2. **前提** 複数のサービスが監視対象として登録済み、**操作** そのうちの1つのサービスが停止、**結果** 停止したサービスのみの通知が表示され、他のサービスは監視継続される
3. **前提** サービスが停止状態、**操作** サービスが再起動される、**結果** 通知が消える、または新しい状態が反映される
4. **前提** 通知が表示中、**操作** ユーザーが通知を閉じる、**結果** 通知が閉じられ、監視は継続される

---

### ユーザーストーリー 2 - サービス一覧表示と選択 (優先度: P2)

システム管理者として、システムにインストールされているWindowsサービスの一覧を表示し、監視したいサービスを選択して登録できるようにしたい。

**この優先度の理由**: 監視対象を柔軟に設定できることで、ユーザーは自分の環境に合わせたカスタマイズが可能になり、実用性が向上します。

**独立テスト**: アプリケーションを起動してサービス一覧画面を開き、任意のサービスを選択して登録することで、設定ファイルに保存されることを確認できます。

**受け入れシナリオ**:

1. **前提** アプリケーションが起動している、**操作** サービス管理画面を開く、**結果** システムにインストールされているすべてのWindowsサービスが一覧表示される
2. **前提** サービス一覧が表示されている、**操作** 監視したいサービスを選択して「登録」ボタンを押す、**結果** 選択したサービスが監視対象リストに追加され、設定ファイルに保存される
3. **前提** サービス一覧が表示されている、**操作** サービス名で検索する、**結果** 検索条件に一致するサービスのみが一覧に表示される
4. **前提** 監視対象リストにサービスが登録済み、**操作** 登録済みサービスを選択して「削除」ボタンを押す、**結果** 監視対象リストから削除され、設定ファイルが更新される

---

### ユーザーストーリー 3 - 設定ファイル管理 (優先度: P3)

システム管理者として、監視設定（監視対象サービスリスト、通知設定、監視間隔など）をファイルで管理し、バックアップや他のシステムへの展開を容易にしたい。

**この優先度の理由**: 設定のファイル管理により、複数環境での設定共有や、設定のバックアップ・リストアが可能になり、運用効率が向上します。

**独立テスト**: 設定ファイルを手動で編集してアプリケーションを再起動し、編集内容が反映されることを確認できます。

**受け入れシナリオ**:

1. **前提** アプリケーションが初回起動、**操作** アプリケーションを起動、**結果** デフォルトの設定ファイル（JSON形式）が自動的に作成される
2. **前提** 設定ファイルが存在する、**操作** アプリケーションを起動、**結果** 設定ファイルから監視対象サービスと設定が読み込まれる
3. **前提** アプリケーションでサービスを登録、**操作** サービスを追加または削除、**結果** 設定ファイルが即座に更新される（アプリケーション再起動不要）
4. **前提** 設定ファイルに無効なデータが含まれる、**操作** アプリケーションを起動、**結果** エラーメッセージが表示され、デフォルト設定で起動する

---

### エッジケース

- 監視対象サービスが存在しない（アンインストールされた）場合、どのように処理するか？
- アプリケーションに管理者権限がなく、一部のサービス情報にアクセスできない場合、どう通知するか？
- 設定ファイルが破損している、または読み取り不可の場合、どう処理するか？
- 同時に複数のサービスが停止した場合、通知はどのように表示されるか？
- サービスが短時間で停止と起動を繰り返す場合、通知の頻度はどう制御されるか？
- システムがスリープモードから復帰した際、監視状態はどう処理されるか？

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは、現在システムにインストールされているすべてのWindowsサービスを一覧表示できる必要がある
- **FR-002**: システムは、ユーザーが一覧から任意のサービスを選択して監視対象として登録できる必要がある
- **FR-003**: システムは、登録された監視対象サービスの状態を定期的に（デフォルト5秒間隔）チェックする必要がある
- **FR-004**: システムは、監視対象サービスが「実行中」から「停止」に状態変化した際、1秒以内にポップアップ通知を表示する必要がある
- **FR-005**: 通知には、サービス名、表示名、停止時刻、停止理由（取得可能な場合）を含む必要がある
- **FR-006**: システムは、監視対象サービスリストと設定をJSON形式のファイルに保存・読み込みできる必要がある
- **FR-007**: ユーザーは、登録済みの監視対象サービスを削除できる必要がある
- **FR-008**: システムは、サービス一覧の検索機能（サービス名による絞り込み）を提供する必要がある
- **FR-009**: 設定ファイルが存在しない場合、初回起動時にデフォルト設定ファイルを自動作成する必要がある
- **FR-010**: 設定ファイルの変更は、アプリケーションの再起動なしに反映される必要がある
- **FR-011**: 通知ウィンドウは、ユーザーが閉じるまで表示されるか、一定時間後（デフォルト30秒）に自動的に閉じる必要がある
- **FR-012**: システムは、管理者権限なしでも基本的な監視機能を提供できる必要がある（権限エラーは適切に処理）

### 主要エンティティ *(機能がデータを含む場合は含める)*

- **監視対象サービス**: システムで監視されるWindowsサービスを表す。属性: サービス名（内部名）、表示名、現在の状態、最終チェック時刻、通知有効/無効フラグ
- **設定情報**: アプリケーションの動作設定を表す。属性: 監視間隔（秒）、通知表示時間（秒）、設定ファイルパス、監視対象サービスリスト
- **通知イベント**: サービス停止時に生成される通知情報を表す。属性: サービス名、表示名、停止時刻、停止理由、通知済みフラグ

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは、アプリケーション起動から30秒以内にサービス一覧を表示し、監視対象を登録できる
- **SC-002**: 監視対象サービスが停止してから1秒以内に通知が表示される
- **SC-003**: システムは、20個の監視対象サービスを同時監視しても、CPU使用率が1%未満、メモリ使用量が50MB以下に抑えられる
- **SC-004**: 設定ファイルは、他のシステムにコピーするだけで同じ監視設定を再現できる（設定の移植性100%）
- **SC-005**: ユーザーは、検索機能を使用して3秒以内に目的のサービスを見つけ、登録できる
- **SC-006**: 通知は、サービス名と停止時刻を含む明確な情報を表示し、ユーザーが即座に問題を認識できる（情報完全性100%）
- **SC-007**: システムは、24時間連続稼働しても、安定して監視を継続できる（稼働安定性100%）

## 前提条件と制約事項

### 前提条件

- Windows 10、Windows 11、または Windows Server 2016 以降の環境で動作する
- .NET 6.0 Runtime 以降がインストールされている
- ユーザーは、基本的なWindowsサービスの概念を理解している

### 制約事項

- 本システムは、Windows環境専用であり、他のOSでは動作しない
- 一部のシステムサービスへのアクセスには管理者権限が必要になる場合がある
- サービス状態の監視は、ポーリング方式（定期チェック）により行われるため、完全なリアルタイム監視ではない
- 設定ファイルは、プレーンテキスト（JSON）形式であり、機密情報（パスワードなど）を含めるべきではない

## 想定される利用シーン

1. **開発環境での利用**: 開発者が、開発中のサービスやデータベースサービスの停止を即座に検知し、デバッグ効率を向上させる
2. **本番環境での利用**: システム管理者が、重要なビジネスサービス（Webサーバー、データベース、メッセージキューなど）の停止を即座に把握し、迅速に対応する
3. **複数サーバー管理**: 複数のサーバーで同じ設定ファイルを使用し、統一された監視体制を構築する
4. **テスト環境での利用**: QAエンジニアが、テスト中のサービスの安定性を監視し、異常を早期に発見する
